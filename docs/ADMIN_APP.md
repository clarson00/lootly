# Admin App Specification

> **Rewards Pirate** - Captain's Quarters (Admin Dashboard)

This document specifies the tenant business owner admin application for Lootly, enabling business owners to manage their loyalty program, build rules, and view analytics.

---

## Overview

The Admin App is a React PWA that allows business owners to:

1. **Dashboard** - View key metrics and activity
2. **Rewards Management** - CRUD operations for rewards
3. **Visual Rules Builder** - Create and manage rules and rulesets (voyages)
4. **Location Management** - Manage locations and groups
5. **Customer Insights** - View customer activity
6. **Settings** - Business configuration

---

## Tech Stack

| Layer | Technology |
|-------|------------|
| Frontend | React + Vite + TypeScript |
| Styling | TailwindCSS |
| State | React Query |
| Forms | React Hook Form |
| Icons | Lucide React |
| Charts | Recharts |

---

## Project Structure

```
admin-app/
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ index.html
â”œâ”€â”€ public/
â”‚   â””â”€â”€ manifest.json
â””â”€â”€ src/
    â”œâ”€â”€ main.tsx
    â”œâ”€â”€ App.tsx
    â”œâ”€â”€ index.css
    â”œâ”€â”€ api/
    â”‚   â”œâ”€â”€ client.ts
    â”‚   â”œâ”€â”€ rules.ts
    â”‚   â”œâ”€â”€ rulesets.ts
    â”‚   â”œâ”€â”€ rewards.ts
    â”‚   â””â”€â”€ dashboard.ts
    â”œâ”€â”€ context/
    â”‚   â””â”€â”€ AdminAuthContext.tsx
    â”œâ”€â”€ hooks/
    â”‚   â”œâ”€â”€ useRules.ts
    â”‚   â”œâ”€â”€ useRulesets.ts
    â”‚   â””â”€â”€ useSimulator.ts
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ Login.tsx
    â”‚   â”œâ”€â”€ Dashboard.tsx
    â”‚   â”œâ”€â”€ Rewards.tsx
    â”‚   â”œâ”€â”€ RewardEdit.tsx
    â”‚   â”œâ”€â”€ Rules.tsx
    â”‚   â”œâ”€â”€ RuleBuilder.tsx
    â”‚   â”œâ”€â”€ Rulesets.tsx
    â”‚   â”œâ”€â”€ RulesetBuilder.tsx
    â”‚   â”œâ”€â”€ Locations.tsx
    â”‚   â”œâ”€â”€ Customers.tsx
    â”‚   â””â”€â”€ Settings.tsx
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ layout/
    â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
    â”‚   â”‚   â”œâ”€â”€ Header.tsx
    â”‚   â”‚   â””â”€â”€ PageContainer.tsx
    â”‚   â”œâ”€â”€ rules/
    â”‚   â”‚   â”œâ”€â”€ ConditionBlock.tsx
    â”‚   â”‚   â”œâ”€â”€ ConditionPicker.tsx
    â”‚   â”‚   â”œâ”€â”€ ConditionGroup.tsx
    â”‚   â”‚   â”œâ”€â”€ AwardPicker.tsx
    â”‚   â”‚   â”œâ”€â”€ PlainLanguagePreview.tsx
    â”‚   â”‚   â””â”€â”€ RuleTemplates.tsx
    â”‚   â”œâ”€â”€ simulator/
    â”‚   â”‚   â”œâ”€â”€ BulkSimulator.tsx
    â”‚   â”‚   â”œâ”€â”€ CustomerSimulator.tsx
    â”‚   â”‚   â”œâ”€â”€ WhatIfSimulator.tsx
    â”‚   â”‚   â””â”€â”€ ProgressVisualizer.tsx
    â”‚   â”œâ”€â”€ rulesets/
    â”‚   â”‚   â”œâ”€â”€ VoyageBuilder.tsx
    â”‚   â”‚   â”œâ”€â”€ RuleChainVisualizer.tsx
    â”‚   â”‚   â””â”€â”€ VoyagePreview.tsx
    â”‚   â””â”€â”€ shared/
    â”‚       â”œâ”€â”€ FeatureGate.tsx
    â”‚       â”œâ”€â”€ DataTable.tsx
    â”‚       â”œâ”€â”€ Modal.tsx
    â”‚       â””â”€â”€ ConfirmDialog.tsx
    â””â”€â”€ lib/
        â”œâ”€â”€ features.ts
        â””â”€â”€ plainLanguage.ts
```

---

## Authentication

Business owner authentication is separate from staff/customer auth.

### Auth Flow

1. Owner enters email address
2. Magic link sent to email (or OTP code)
3. Owner clicks link / enters code
4. JWT issued with business context
5. All admin API calls include `businessId` from token

### API Endpoints

```
POST /api/admin/auth/request-code
  Body: { email: "owner@tonys.com" }
  Response: { success: true, message: "Check your email" }

POST /api/admin/auth/verify-code
  Body: { email: "owner@tonys.com", code: "123456" }
  Response: { token: "jwt...", business: { id, name } }

GET /api/admin/auth/me
  Headers: Authorization: Bearer <token>
  Response: { business: { id, name, tier }, owner: { email, name } }
```

---

## Visual Rules Builder

### Design Philosophy

**Form-based, not drag-and-drop:**
- Guided step-by-step flow
- Validates as you go
- Mobile-friendly
- Plain language preview always visible

### Builder Flow

#### Step 1: Choose Starting Point

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create a New Rule                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Start from a template:                                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ğŸ¯           â”‚  â”‚ ğŸ†           â”‚  â”‚ ğŸ’°           â”‚          â”‚
â”‚  â”‚ Visit Bonus  â”‚  â”‚ Grand Tour   â”‚  â”‚ Big Spender  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âœ¨ Start from Scratch                                  â”‚    â”‚
â”‚  â”‚     Build yer own custom rule, matey!                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 2: Build Conditions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rule: Weekend Warrior                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“£ PLAIN ENGLISH                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ "When a scallywag visits at least 2 different ports     â”‚   â”‚
â”‚  â”‚  within 7 days AND it be Saturday or Sunday, award      â”‚   â”‚
â”‚  â”‚  50 bonus doubloons."                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  WHEN (conditions):                                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ Location Visit                                  [ âœ• ]â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ Customer visits  [at least â–¼]  [2]  [different â–¼]       â”‚   â”‚
â”‚  â”‚ locations from   [any location â–¼]                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚                         [ AND â–¼ ]                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“† Day of Week                                     [ âœ• ]â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ On  [ ] Mon  [ ] Tue  [ ] Wed  [ ] Thu  [ ] Fri         â”‚   â”‚
â”‚  â”‚     [âœ“] Sat  [âœ“] Sun                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”   â”‚
â”‚  â”‚             [ + Add Condition Block ]                    â”‚   â”‚
â”‚  â””â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  THEN (award):                                                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Award Type:  [Bonus Points â–¼]                           â”‚   â”‚
â”‚  â”‚              [50] doubloons                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Condition Block Picker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Add Condition Block                                    [ âœ• ]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“ LOCATION              ğŸ’µ SPENDING            ğŸ›’ PRODUCT     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Visit        â”‚        â”‚ Spend amount â”‚      â”‚ Buy product  â”‚â”‚
â”‚  â”‚ locations    â”‚        â”‚              â”‚      â”‚     [PRO]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“… TIME                  ğŸ‘¤ CUSTOMER            ğŸ”— RULE        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Time window  â”‚        â”‚ Customer     â”‚      â”‚ Previous     â”‚â”‚
â”‚  â”‚ (within X)   â”‚        â”‚ attribute    â”‚      â”‚ rule         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Day of week  â”‚        â”‚ Has tag      â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Test Simulator UI

### Bulk Simulation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§ª TEST RULE: Weekend Warrior                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“Š IF THIS RULE WERE ACTIVE RIGHT NOW                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  âœ…  23 scallywags would have already qualified         â”‚   â”‚
â”‚  â”‚      (met all conditions in the past)                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â³  47 scallywags are close                             â”‚   â”‚
â”‚  â”‚      â””â”€ 31 visited 1 port (need 2)                      â”‚   â”‚
â”‚  â”‚      â””â”€ 16 visited 2+ but not on weekend                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  ğŸ’°  Estimated impact                                    â”‚   â”‚
â”‚  â”‚      â””â”€ 1,150 bonus doubloons would be awarded          â”‚   â”‚
â”‚  â”‚      â””â”€ ~$23 equivalent value                           â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [ View qualifying customers ]                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Individual Customer Test

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Test with specific customer                                    â”‚
â”‚                                                                 â”‚
â”‚  Search: [ jane.smith@email.com        ]  [ Search ]            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ‘¤ Jane Smith                                          â”‚   â”‚
â”‚  â”‚     Crew member since: Oct 2024 â€¢ 1,250 doubloons       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Rule Status: â³ NOT YET QUALIFIED                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Condition Breakdown:                                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“ Visit 2+ ports within 7 days                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    Status: âŒ 1 of 2                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50%               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    âœ… Tony's Pizza â€” Jan 28, 2:30pm             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    â¬œ Need 1 more port                           â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  ğŸ“ Summary: Jane needs to visit 1 more port            â”‚   â”‚
â”‚  â”‚     today (Saturday) to trigger this rule.              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### What-If Scenario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”® WHAT IF SCENARIO                                            â”‚
â”‚                                                                 â”‚
â”‚  Customer: [ Jane Smith â–¼ ]                                     â”‚
â”‚                                                                 â”‚
â”‚  Simulate this action:                                          â”‚
â”‚                                                                 â”‚
â”‚  Action:   [ Visit â–¼ ]                                          â”‚
â”‚  Location: [ Casa Verde â–¼ ]                                     â”‚
â”‚  Spend:    [ $45.00 ]                                          â”‚
â”‚                                                                 â”‚
â”‚  [ Run Simulation ]                                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ‰ RULE WOULD TRIGGER!                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  If Jane drops anchor at Casa Verde right now:          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  âœ… 2 ports in 7 days (Tony's + Casa Verde)             â”‚   â”‚
â”‚  â”‚  âœ… On Saturday                                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Jane would earn:                                        â”‚   â”‚
â”‚  â”‚  â€¢ 50 bonus doubloons (from this rule)                  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Her new total: 1,300 doubloons                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ruleset (Voyage) Builder

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Voyage: The Grand Voyage                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“£ PLAIN ENGLISH                                        â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ "Customers complete a 4-port voyage. Each port earns    â”‚   â”‚
â”‚  â”‚  25 doubloons. After visiting all 4, they unlock the    â”‚   â”‚
â”‚  â”‚  Grand Treasure ($50 off) and earn 2x doubloons         â”‚   â”‚
â”‚  â”‚  forever, ye scurvy dog!"                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  VISUAL FLOW:                                                   â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚ Port 1  â”‚   â”‚ Port 2  â”‚   â”‚ Port 3  â”‚   â”‚ Port 4  â”‚       â”‚
â”‚    â”‚ Tony's  â”‚â”€â”€â–¶â”‚ Casa    â”‚â”€â”€â–¶â”‚ Bella   â”‚â”€â”€â–¶â”‚ Dragon  â”‚       â”‚
â”‚    â”‚ Pizza   â”‚   â”‚ Verde   â”‚   â”‚ Italia  â”‚   â”‚ Wok     â”‚       â”‚
â”‚    â”‚ ğŸ•      â”‚   â”‚ ğŸŒ®      â”‚   â”‚ ğŸ      â”‚   â”‚ ğŸ¥¡      â”‚       â”‚
â”‚    â”‚ +25 pts â”‚   â”‚ +25 pts â”‚   â”‚ +25 pts â”‚   â”‚ +25 pts â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚             â”‚             â”‚             â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚  ğŸ† TREASURE    â”‚                          â”‚
â”‚                    â”‚    UNLOCKED!    â”‚                          â”‚
â”‚                    â”‚                 â”‚                          â”‚
â”‚                    â”‚ â€¢ $50 reward    â”‚                          â”‚
â”‚                    â”‚ â€¢ 2x multiplier â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                 â”‚
â”‚  RULES IN THIS VOYAGE:                       [ + Add Rule ]     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Port o' Call: Tony's Pizza                  [Edit]   â”‚   â”‚
â”‚  â”‚    When: Visit Tony's Pizza                             â”‚   â”‚
â”‚  â”‚    Award: 25 bonus doubloons                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ...                                                            â”‚
â”‚                                                                 â”‚
â”‚  CHAIN SETTINGS:                                                â”‚
â”‚                                                                 â”‚
â”‚  Order: [âœ“] Any order  [ ] Must be sequential                  â”‚
â”‚  Time limit: [ ] None  [ ] Complete within [__] days           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Admin API Endpoints

### Rules

```
GET    /api/admin/rules                   - List all rules
GET    /api/admin/rules/:id               - Get single rule
POST   /api/admin/rules                   - Create rule
PUT    /api/admin/rules/:id               - Update rule
DELETE /api/admin/rules/:id               - Delete rule
POST   /api/admin/rules/:id/activate      - Activate rule
POST   /api/admin/rules/:id/deactivate    - Deactivate rule
POST   /api/admin/rules/:id/simulate/bulk - Bulk simulation
POST   /api/admin/rules/:id/simulate/customer - Customer simulation
POST   /api/admin/rules/:id/simulate/what-if  - What-if simulation
```

### Rulesets (Voyages)

```
GET    /api/admin/rulesets                - List all rulesets
GET    /api/admin/rulesets/:id            - Get single ruleset with rules
POST   /api/admin/rulesets                - Create ruleset
PUT    /api/admin/rulesets/:id            - Update ruleset
DELETE /api/admin/rulesets/:id            - Delete ruleset
POST   /api/admin/rulesets/:id/simulate/customer - Progress simulation
```

### Rewards

```
GET    /api/admin/rewards                 - List all rewards
GET    /api/admin/rewards/:id             - Get single reward
POST   /api/admin/rewards                 - Create reward
PUT    /api/admin/rewards/:id             - Update reward
DELETE /api/admin/rewards/:id             - Delete reward
```

### Dashboard

```
GET    /api/admin/dashboard/stats         - Key metrics
GET    /api/admin/dashboard/activity      - Recent activity
GET    /api/admin/dashboard/rule-analytics - Rule performance
```

### All admin routes require:
- `Authorization: Bearer <admin_token>` header
- Business context from token
- Feature gating via `requireFeature()` middleware

---

## Feature Gating in Admin UI

```tsx
import { FeatureGate } from '@/components/shared/FeatureGate';
import { FEATURES } from '@/lib/features';

// Advanced conditions only for Starter+
<FeatureGate feature={FEATURES.RULES_ADVANCED} fallback={<UpgradePrompt />}>
  <ConditionGroup operator="AND" />
</FeatureGate>

// Product conditions only for Pro
<FeatureGate feature={FEATURES.RULES_PRODUCT}>
  <ProductConditionBlock />
</FeatureGate>
```

---

## Pirate Theme Language

| Standard Term | Pirate Term |
|---------------|-------------|
| Points | Doubloons |
| Locations | Ports |
| Customers | Crew / Scallywags |
| Visit | Drop anchor |
| Rewards | Treasure |
| Rules | Ship's Orders |
| Rulesets | Voyages |
| Progress | Journey |
| Complete | Conquered |
| Unlock | Plunder |

---

## Related Documentation

- [RULES_ENGINE.md](./RULES_ENGINE.md) - Rules engine specification
- [GAMIFICATION.md](./GAMIFICATION.md) - Customer-facing experience
- [ENTITLEMENTS.md](./ENTITLEMENTS.md) - Feature gating

---

*Last updated: January 2025*
